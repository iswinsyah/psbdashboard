<!DOCTYPE html>
<!-- Halaman Data Leads Mitra -->
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Prospek Saya - Portal Mitra</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="style.css" rel="stylesheet">
    <style>
        .status-dropdown {
            color: white;
            font-weight: 500;
            border-radius: 0.375rem; /* Menyesuaikan dengan radius badge */
        }
        .status-dropdown.text-dark {
            color: black !important;
        }
    </style>
</head>
<body>

    <div class="d-flex" id="wrapper">

        <!-- Sidebar Khusus Mitra -->
        <div id="sidebar-wrapper" style="background-color: #2c3e50;">
            <div class="sidebar-heading">
                <div class="text-white fw-bold">MITRA AREA</div>
                <small class="text-muted">Halo, Pak Ahmad</small>
            </div>
            <div class="list-group list-group-flush mt-3">
                <a href="portal-mitra.html" class="list-group-item list-group-item-action">
                    <i class="fas fa-bullhorn me-2"></i> Alat Promosi
                </a>
                <a href="leads-mitra.html" class="list-group-item list-group-item-action active">
                    <i class="fas fa-address-book me-2"></i> Data Prospek
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    <i class="fas fa-wallet me-2"></i> Komisi Saya
                </a>
                <a href="#" class="list-group-item list-group-item-action">
                    <i class="fas fa-user me-2"></i> Profil
                </a>
                <div class="border-top my-3 border-secondary"></div>
                <a href="index.html" class="list-group-item list-group-item-action text-danger">
                    <i class="fas fa-sign-out-alt me-2"></i> Kembali ke Admin
                </a>
            </div>
        </div>

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
                <div class="container-fluid">
                    <div class="fw-bold">Daftar Orang yang Masuk Lewat Link Anda</div>
                </div>
            </nav>

            <div class="container-fluid px-4 py-4">
                
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted text-uppercase fw-bold">Total Leads</small>
                                    <h3 class="fw-bold mb-0 text-primary">12</h3>
                                </div>
                                <i class="fas fa-users fa-2x text-black-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted text-uppercase fw-bold">Potensi Komisi</small>
                                    <h3 class="fw-bold mb-0 text-warning">Rp 600rb</h3>
                                </div>
                                <i class="fas fa-coins fa-2x text-black-50"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white py-3">
                        <h6 class="mb-0 fw-bold text-secondary"><i class="fas fa-list me-2"></i> Riwayat "Tangkapan" Anda</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Nama Prospek</th>
                                        <th>Sumber</th>
                                        <th>Status Admin</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>28 Jan 2026</td>
                                        <td class="fw-bold">Ibu Rina</td>
                                        <td><span class="badge bg-primary fw-normal">Ebook</span></td>
                                        <td>
                                            <select class="form-select form-select-sm status-dropdown" onchange="updateStatusColor(this)">
                                                <option selected>Baru Masuk</option>
                                                <option>Sudah masuk grup</option>
                                                <option>Followup</option>
                                                <option>Bersedia hadir</option>
                                                <option>Hadir</option>
                                                <option>Minat Daftar</option>
                                                <option>Daftar</option>
                                            </select>
                                        </td>
                                        <td><button class="btn btn-sm btn-success" onclick="openFollowUp('Ibu Rina')"><i class="fab fa-whatsapp"></i> Follow Up</button></td>
                                    </tr>
                                    <tr>
                                        <td>27 Jan 2026</td>
                                        <td class="fw-bold">Pak Budi</td>
                                        <td><span class="badge bg-warning text-dark fw-normal">Tes Hafidz</span></td>
                                        <td>
                                            <select class="form-select form-select-sm status-dropdown" onchange="updateStatusColor(this)">
                                                <option>Baru Masuk</option>
                                                <option>Sudah masuk grup</option>
                                                <option selected>Followup</option>
                                                <option>Bersedia hadir</option>
                                                <option>Hadir</option>
                                                <option>Minat Daftar</option>
                                                <option>Daftar</option>
                                            </select>
                                        </td>
                                        <td><button class="btn btn-sm btn-success" onclick="openFollowUp('Pak Budi')"><i class="fab fa-whatsapp"></i> Follow Up</button></td>
                                    </tr>
                                    <tr>
                                        <td>25 Jan 2026</td>
                                        <td class="fw-bold">Keluarga Pak Andi</td>
                                        <td><span class="badge bg-primary fw-normal">Ebook</span></td>
                                        <td><span class="badge bg-success">Closing (Lunas)</span></td>
                                        <td><button class="btn btn-sm btn-secondary" disabled>Selesai</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="alert alert-light mt-3 mb-0 small">
                            <i class="fas fa-info-circle me-1"></i> 
                            Data ini sinkron dengan database Admin. Jika status berubah menjadi <strong>Closing</strong>, komisi akan otomatis masuk ke dompet Anda.
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Generator Pesan Follow Up -->
    <div class="modal fade" id="followUpModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Follow Up: <span id="modalProspekName" class="text-primary"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info small py-2 mb-3">
                        <i class="fas fa-info-circle me-1"></i> Ajak mereka masuk ke Zoominar agar lebih yakin mendaftar.
                    </div>

                    <label class="small fw-bold text-secondary mb-2">Pilih Jenis Pesan</label>
                    <select class="form-select form-select-sm mb-3" id="followUpAngle" onchange="generateFollowUp()">
                        <option value="invite">1. Undangan Awal (Baru Gabung)</option>
                        <option value="reminder">2. Reminder H-1 (Besok Acara)</option>
                        <option value="link">3. Share Link Zoom (Hari H)</option>
                    </select>
                    
                    <label class="small fw-bold text-secondary mb-2">Preview Pesan</label>
                    <textarea class="form-control mb-3 text-muted bg-light" id="followUpMsg" rows="6" style="font-size: 0.9rem;" readonly></textarea>
                    
                    <button class="btn btn-success w-100 fw-bold" onclick="sendFollowUp()">
                        <i class="fab fa-whatsapp me-2"></i> KIRIM KE WHATSAPP
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentProspek = "";

        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 10) return "Selamat Pagi";
            if (hour < 15) return "Selamat Siang";
            if (hour < 18) return "Selamat Sore";
            return "Selamat Malam";
        }

        // Fungsi Spintax untuk variasi pesan (Anti-Banned WA)
        function spinText(text) {
            return text.replace(/\{([^{}]+)\}/g, function(match, content) {
                const choices = content.split('|');
                return choices[Math.floor(Math.random() * choices.length)];
            });
        }

        const templates = {
            invite: "{SALAM} {NAMA}. {Terima kasih|Makasih} sudah {download|unduh} Ebook/Ikut Tes kemarin ya. ðŸ˜Š {Sekadar info|Mau infoin}, kami ada *{EVENT_NAME}* pada {EVENT_DATE} pukul {EVENT_TIME}. {Materinya bagus banget|Isinya daging banget} buat melengkapi Ebook kemarin. {Mau saya kirimkan infonya?|Boleh saya share detailnya?}",
            reminder: "{SALAM} {NAMA}. {Mengingatkan|Cuma mau ingetin} {EVENT_DATE} jam {EVENT_TIME} kita ada {EVENT_NAME} ya. {Pastikan alarmnya dipasang|Jangan lupa pasang alarm} biar nggak ketinggalan {materi dagingnya|ilmu mahal ini}! â°",
            link: "{SALAM} {NAMA}. {Acaranya sebentar lagi mulai ya!|Acara segera dimulai!} ðŸš€ Ini link aksesnya: {EVENT_LINK}. {Ditunggu kehadirannya|Sampai jumpa di lokasi} ya {Bun/Pak|Ayah/Bunda}!"
        };

        function openFollowUp(name) {
            currentProspek = name;
            document.getElementById('modalProspekName').innerText = name;
            document.getElementById('followUpAngle').value = 'invite'; // Default
            generateFollowUp();
            
            var myModal = new bootstrap.Modal(document.getElementById('followUpModal'));
            myModal.show();
        }

        function generateFollowUp() {
            // Ambil data event dari LocalStorage (Settingan Admin)
            const eventData = JSON.parse(localStorage.getItem('eventData')) || {
                name: 'Zoominar Parenting',
                date: 'Sabtu Besok',
                time: '09.00 WIB',
                link: 'bit.ly/ZoomParentingBaron'
            };

            // Pastikan link ada protokol https:// agar bisa diklik di WA
            let eventLink = eventData.link;
            if (eventLink && !eventLink.startsWith('http')) {
                eventLink = "https://" + eventLink;
            }

            const angle = document.getElementById('followUpAngle').value;
            const greeting = getGreeting();
            
            let template = templates[angle];
            let message = template.replace("{SALAM}", greeting).replace("{NAMA}", currentProspek)
                                  .replace(/{EVENT_NAME}/g, eventData.name).replace(/{EVENT_DATE}/g, eventData.date)
                                  .replace(/{EVENT_TIME}/g, eventData.time).replace(/{EVENT_LINK}/g, eventLink);
            message = spinText(message); // Acak kata-kata

            document.getElementById('followUpMsg').value = message;
        }

        function sendFollowUp() {
            var msgText = document.getElementById('followUpMsg').value;
            var encodedMsg = encodeURIComponent(msgText);
            // Di sistem real, kita akan ambil nomor WA dari database berdasarkan nama prospek
            // Untuk prototype ini, kita buka WA umum
            var waUrl = "https://wa.me/?text=" + encodedMsg; 
            
            window.open(waUrl, '_blank');
        }

        function updateStatusColor(selectElement) {
            // Hapus semua kelas warna yang mungkin ada
            selectElement.classList.remove('bg-secondary', 'bg-info', 'bg-warning', 'bg-success', 'text-dark');

            const value = selectElement.value;
            if (value === 'Baru Masuk') {
                selectElement.classList.add('bg-secondary');
            } else if (value === 'Sudah masuk grup' || value === 'Followup') {
                selectElement.classList.add('bg-info', 'text-dark');
            } else if (value === 'Bersedia hadir' || value === 'Hadir') {
                selectElement.classList.add('bg-warning', 'text-dark');
            } else if (value === 'Minat Daftar' || value === 'Daftar') {
                selectElement.classList.add('bg-success');
            }
        }

        // Panggil saat halaman dimuat untuk memberi warna awal pada dropdown
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.status-dropdown').forEach(function(dropdown) {
                updateStatusColor(dropdown);
            });
        });
    </script>
</body>
</html>